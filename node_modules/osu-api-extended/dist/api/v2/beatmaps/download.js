"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const request_1 = require("../../../utility/request");
const name = (obj) => __awaiter(void 0, void 0, void 0, function* () {
    let url = '';
    let headers = {
        accept: 'application/octet-stream',
    };
    const progress_track = (progress) => {
        obj.progress_track_fn(obj.from, progress);
    };
    switch (obj.from) {
        case 'chimu':
            url = `https://api.chimu.moe/v1/download/${obj.beatmapset_id}`;
            break;
        case 'beatconnect':
            url = `https://beatconnect.io/b/${obj.beatmapset_id}/`;
            break;
        case 'sayobot':
            url = `https://dl.sayobot.cn/beatmaps/download/${obj.no_video ? 'novideo' : 'full'}/${obj.beatmapset_id}`;
            break;
        // DOESNT WORK FOR SOME REASON
        // case 'nerinyan':
        //   url = `https://api.nerinyan.moe/d/${obj.beatmapset_id}${obj.no_video ? '?nv=1' : ''}`;
        //   headers = {
        //     accept: 'application/x-osu-beatmap-archive'
        //   };
        //   break;
        case 'osu_direct_mirror':
            url = `https://api.osu.direct/d/${obj.beatmapset_id}`;
            break;
        case 'gatari':
            url = `https://osu.gatari.pw/d/${obj.beatmapset_id}`;
            headers['Referer'] = 'https://osu.gatari.pw/';
            break;
        case 'ripple':
            url = `https://storage.ripple.moe/d/${obj.beatmapset_id}`;
            headers['Referer'] = 'https://ripple.moe/';
            break;
        case 'akatsuki':
            url = `https://akatsuki.gg/d/${obj.beatmapset_id}`;
            headers['Referer'] = 'https://akatsuki.gg/';
            break;
        case 'catboy':
            url = `https://catboy.best/d/${obj.beatmapset_id}`;
            headers['Referer'] = 'https://catboy.best/';
            break;
        case 'osu':
        default:
            url = `https://osu.ppy.sh/api/v2/beatmapsets/${obj.beatmapset_id}/download${obj.no_video ? '?noVideo=1' : ''}`;
            headers['Referer'] = 'https://osu.ppy.sh/';
            break;
    }
    ;
    const data = yield (0, request_1.download)(url, obj.file_path, {
        _callback: obj.progress_track_fn != null,
        headers,
        callback: progress_track,
    });
    return data;
});
exports.default = name;
